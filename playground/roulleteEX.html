<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

  <style>

  </style>

  <script>
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");

    var colors = ["#336600", "#660000", "#000000", "#660000",
      "#000000", "#660000", "#000000", "#660000",
      "#000000", "#660000", "#000000", "#660000", "#000000", "#660000", "#000000"];
    var numbers = ["0", "1", "8", "2",
      "9", "3", "10", "4",
      "11", "5", "12", "6", "13", "7", "14"];
    var pocketCount = 12;
    var cheatText = numbers[4];
    $('#cheat').text('Stop on ' + cheatText);

    var cw = canvas.width = ch = canvas.height = 500;
    var cx = cw / 2;
    var cy = ch / 2;

    // wheel & arrow are used often so cache them
    var wheelCanvas = drawRouletteWheel();
    var arrow = drawArrow();

    var wheel = {
      cx: cw / 2,
      cy: ch / 2,
      radius: Math.min(cw, ch) / 2 - 20,
      startAngle: 0,
      endAngle: Math.PI * 4 + cheatingSpin(cheatText),
      totalSteps: 360,
      currentStep: 0,
    }

    drawAll(wheel);

    $('#spin').click(function () { requestAnimationFrame(animate); $(this).hide() });


    // funcs

    function cheatingSpin(hit) {
      var PI = Math.PI;
      var PI2 = PI * 2;
      var index = numbers.indexOf(cheatText);
      var pocketSweep = PI2 / pocketCount;
      // cheatText not in numbers[]? -- then spin randomly
      if (index < 0) { return (PI2 * 2 + Math.random() * PI2); }
      // if cheating, calc random endAngle inside desired number's pocket
      return ((PI2 - pocketSweep * (index + 1)) + Math.random() * pocketSweep - PI / 2);
    }

    function animate(time) {
      if (wheel.currentStep > wheel.totalSteps) { return; }
      drawAll(wheel);
      wheel.currentStep++;
      requestAnimationFrame(animate);
    }

    function easing(w) {
      var t = w.currentStep;
      var b = w.startAngle;
      var d = w.totalSteps;
      var c = w.endAngle - w.startAngle;
      // Penner's OutQuart
      return (-c * ((t = t / d - 1) * t * t * t - 1) + b + w.startAngle);
    }

    function drawAll(w) {
      var angle = easing(w);
      ctx.clearRect(0, 0, cw, ch);
      ctx.translate(cx, cy);
      ctx.rotate(angle);
      ctx.drawImage(wheelCanvas, -wheelCanvas.width / 2, -wheelCanvas.height / 2);
      ctx.rotate(-angle);
      ctx.translate(-cx, -cy);
      ctx.drawImage(arrow, cx - arrow.width / 2, 44);
    }

    function drawRouletteWheel() {
      var outsideRadius = 200;
      var textRadius = 160;
      var insideRadius = 125;
      var canvas = document.createElement("canvas");
      var ctx = canvas.getContext("2d");
      canvas.width = canvas.height = outsideRadius * 2 + 6;
      var x = outsideRadius + 3;
      var y = outsideRadius + 3;
      var arc = Math.PI / (pocketCount / 2);
      ctx.strokeStyle = "black";
      ctx.lineWidth = 2;
      ctx.font = 'bold 18px Helvetica, Arial';
      // wheel
      for (var i = 0; i < pocketCount; i++) {
        var angle = i * arc;
        ctx.fillStyle = colors[i];
        ctx.beginPath();
        ctx.arc(x, y, outsideRadius, angle, angle + arc, false);
        ctx.arc(x, y, insideRadius, angle + arc, angle, true);
        ctx.stroke();
        ctx.fill();
        ctx.save();
        ctx.shadowOffsetX = -1;
        ctx.shadowOffsetY = -1;
        ctx.shadowBlur = 0;
        ctx.shadowColor = "rgb(220,220,220)";
        ctx.fillStyle = "white";
        ctx.translate(x + Math.cos(angle + arc / 2) * textRadius,
          y + Math.sin(angle + arc / 2) * textRadius);
        ctx.rotate(angle + arc / 2 + Math.PI / 2);
        var text = numbers[i];
        ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
        ctx.restore();
      }
      //
      return (canvas);
    }

    function drawArrow() {
      var canvas = document.createElement("canvas");
      var ctx = canvas.getContext("2d");
      canvas.width = 18;
      canvas.height = 18;
      //Arrow
      ctx.fillStyle = "yellow";
      ctx.beginPath();
      ctx.moveTo(5, 0);
      ctx.lineTo(13, 0);
      ctx.lineTo(13, 10);
      ctx.lineTo(18, 10);
      ctx.lineTo(9, 18);
      ctx.lineTo(0, 10);
      ctx.lineTo(5, 10);
      ctx.lineTo(5, 0);
      ctx.fill();
      return (canvas);
    }
  </script>

</head>


<body>

  <input type="button" value="spin" style="float:left;" id='spin' />
<canvas id="canvas" width="500" height="500"></canvas>



</body>

</html>